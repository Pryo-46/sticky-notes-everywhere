# 付箋セット機能 実装計画

## 概要

付箋を「セット」として名前をつけて保存・管理できる機能。

## ユーザーの要件

1. 貼り付けた付箋を丸ごと保存したい
2. 任意のページで保存した付箋を読み込みたい
3. 保存先のセットを選びたい（上書き保存）
4. 保存忘れたときに履歴から書いた付箋を復元したい

## 機能設計

### セット（手動保存）
- 名前付きで保存
- ページに紐づかない（どのページでも読み込み可能）
- 新規保存 or 既存セットに上書き保存

### 自動バックアップ（履歴）
- 付箋変更時に自動保存
- ページURL+タイトルに紐づく
- 直近50ページ分を保持
- 保存忘れ時の復元用

## データ構造

```typescript
/** 付箋セット */
interface StickyNoteSet {
  id: string;
  name: string;
  notes: StickyNoteData[];
  createdAt: number;
  updatedAt: number;
}

/** ページ履歴（自動バックアップ） */
interface PageHistory {
  url: string;
  title: string;
  notes: StickyNoteData[];
  savedAt: number;
}
```

## ストレージキー

| キー | 用途 |
|------|------|
| `stickyNotesData` | 現在の付箋（既存） |
| `stickyNotesSets` | 名前付きセット一覧 |
| `stickyNotesPageHistory` | 自動バックアップ（最大50件） |

## UI設計

```
┌─────────────────────────────────────┐
│ 付箋の保存・読み込み              ✕ │
├─────────────────────────────────────┤
│ ■ 保存                              │
│ ┌─────────────────────────────────┐ │
│ │ [+ 新しいセットとして保存...]    │ │
│ │ ─────────────────────────────── │ │
│ │ プロジェクトA用        [上書き]  │ │
│ │ 読書メモ               [上書き]  │ │
│ └─────────────────────────────────┘ │
│ ※現在の付箋がない場合は非活性        │
├─────────────────────────────────────┤
│ ■ 読み込み                          │
│ ┌─────────────────────────────────┐ │
│ │ ▼ 保存済みセット                 │ │
│ │   プロジェクトA用    [✏️] [🗑️]  │ │
│ │   読書メモ           [✏️] [🗑️]  │ │
│ │ ▼ 自動バックアップ  [すべて削除] │ │
│ │   ページタイトル1 - 12/21 10:30  │ │
│ │   ページタイトル2 - 12/21 10:25  │ │
│ └─────────────────────────────────┘ │
│ ※クリックで読み込み（置換/マージ選択）│
└─────────────────────────────────────┘
```

### UI変更点（現状からの差分）

1. **モーダルタイトル変更**: 「付箋セット管理」→「付箋の保存・読み込み」
2. **「保存」セクション追加**: 新規保存ボタン + 既存セット上書きボタン
3. **「読み込み」セクション**: 保存済みセット + 自動バックアップを統合
4. **履歴の名称変更**: 「ページ履歴」→「自動バックアップ」

## 操作フロー

### 保存フロー
```
[新しいセットとして保存] → 名前入力ダイアログ → 保存完了
[上書き] → 確認ダイアログ「○○に上書きしますか？」→ 保存完了
```

### 読み込みフロー
```
[セット/バックアップをクリック] → 置換/マージ選択ダイアログ → 読み込み完了
```

## 実装変更箇所

### SetManagerRenderer.ts
- `renderModal()`: 保存セクションと読み込みセクションに分離
- 上書きボタンの追加
- セクションヘッダーの変更

### SetManagerController.ts
- `onOverwriteSet` コールバック追加
- 上書きボタンのイベントハンドリング
- 上書き確認ダイアログ

### SetManager.ts
- `overwriteSet()` メソッド追加

## 実装順序

1. SetManagerRenderer.ts - UI変更
2. SetManagerController.ts - イベント処理追加
3. SetManager.ts - 上書き保存ロジック追加

## 注意点

- 現在の付箋がない場合、保存セクション全体を非活性に
- 上書き保存時は確認ダイアログ必須
- 読み込み時の置換/マージ選択は既存のまま
